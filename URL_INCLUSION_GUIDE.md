# URL Inclusion Guide

This guide explains how to ensure that article URLs are always included in responses.

## Problem
When asking about specific articles (like "Who wrote the article titled 'R. Kelly Hospitalized Following Alleged Overdose In Prison'?"), the system returns the author but doesn't include the source URL.

## Solution Implemented

### 1. Updated API Routes (`api/routes.py`)
Added a new endpoint `/latest-articles` that always returns articles with their URLs:

```python
@router.get("/latest-articles")
def get_latest_articles():
    """Get latest articles with their source URLs."""
```

### 2. Updated Cypher Prompt (`llm/prompts.py`)
Modified the Cypher query generation to always include URLs:

```
- For ANY query that returns article information, ALWAYS include the URL by matching the HAS_URL relationship and return `u.url AS source_url`.
- When returning article data, always use the pattern: `MATCH (a:Article)-[:HAS_URL]->(u:URL)` and include `u.url AS source_url` in the RETURN clause.
```

### 3. Updated QA Prompt (`llm/prompts.py`)
Added explicit instructions to include URLs:

```
- ALWAYS include the source URL when it's available in the result data, regardless of the query type.
- When mentioning an article, always provide the URL if it exists in the result.
- For queries about specific articles (titles, authors, content), always include the source URL in your response.
```

### 4. Updated Result Formatter (`utils/result_formatter.py`)
Added URL inclusion instructions:

```
- ALWAYS include the source URL when it's available in the raw data, regardless of the query type.
- When mentioning an article, always provide the URL if it exists in the raw data.
```

## Testing

### Method 1: Direct API Endpoint
```bash
curl http://localhost:8000/latest-articles
```

### Method 2: Explicit Query
```bash
curl -X POST http://localhost:8000/ask \
  -H "Content-Type: application/json" \
  -d '{"query": "Show me the article \"R. Kelly Hospitalized Following Alleged Overdose In Prison\" with its author and URL"}'
```

### Method 3: Using the Demo Script
```bash
python demo_articles_with_urls.py
```

## Expected Behavior

After implementing these changes, when you ask:
- "Who wrote the article titled 'R. Kelly Hospitalized Following Alleged Overdose In Prison'?"

The system should respond:
- "The article 'R. Kelly Hospitalized Following Alleged Overdose In Prison' was written by Sam Moore. Source: https://hiphopdx.com/news/r-kelly-hospitalized-following-overdose-prison"

## Troubleshooting

If URLs are still not showing:

1. **Restart the server** to ensure all changes are loaded
2. **Check the Cypher query** being generated by adding debug logging
3. **Verify the database** has the HAS_URL relationships properly set up
4. **Test with explicit queries** that ask for URLs directly

## Database Schema

The system expects this relationship structure:
```
(a:Article)-[:HAS_URL]->(u:URL)
```

Where:
- `Article` nodes have properties: `title`, `author`, `description`, `publication_date`
- `URL` nodes have property: `url`
- The `HAS_URL` relationship connects articles to their source URLs
